{% extends "base_client.html" %}

{% block title %}Détails - Recherche{% endblock %}

{% block content %}
<div class="details-header">
  <div class="details-title">
    <h2>Recherche</h2>
    <div class="details-actions">
      <a class="action-link" href="{{ url_for('bdc.details', bon_id=bon.id) }}"><i class="fas fa-info-circle"></i> Informations</a>
      <a class="action-link" href="{{ url_for('bdc.details_similaires', bon_id=bon.id) }}"><i class="fas fa-link"></i> Similaires</a>
    </div>
  </div>
</div>

<form method="get" action="{{ url_for('bdc.details_recherche', bon_id=bon.id) }}" class="search-form" style="margin: 30px;">
  <div class="content-card">
    <div class="form-grid">
      <div class="form-row">
        <label>Requête</label>
        <input type="text" name="q" value="{{ request.args.get('q', '') }}" />
      </div>
      <div class="form-row">
        <label>Montant min</label>
        <input type="text" name="min_montant" value="{{ request.args.get('min_montant', '') }}" />
      </div>
      <div class="form-row">
        <label>Montant max</label>
        <input type="text" name="max_montant" value="{{ request.args.get('max_montant', '') }}" />
      </div>
      <div class="form-row">
        <label>Rechercher dans</label>
        <select name="search_in">
          <option value="both" {% if search_in=='both' %}selected{% endif %}>Les deux</option>
          <option value="new" {% if search_in=='new' %}selected{% endif %}>Nouveaux</option>
          <option value="old" {% if search_in=='old' %}selected{% endif %}>Anciens</option>
        </select>
      </div>
    </div>
    <button class="action-link" type="submit" style="border:none;">Rechercher</button>
  </div>
</form>

{% if bons_recherche %}
<div class="bdc-grid">
  {% for b in bons_recherche %}
    <div class="bdc-card reveal">
      <div class="bdc-card-header">
        <h3 class="bdc-card-title">{{ (b.objet or 'Bon de commande')|capitalize }}</h3>
      </div>
      <div class="bdc-card-body">
        <ul class="bdc-card-details">
          <li><strong>Référence</strong> {{ b.reference }}</li>
          <li><strong>Nature</strong> {{ b.nature }}</li>
          <li><strong>Lieu</strong> {{ ' '.join(b.lieu.split()[:10]) }}</li>
          <li><strong>Date</strong> {{ b.date_mise_en_ligne }}</li>
          <li><strong>Montant</strong> {{ b.montant_str }}</li>
        </ul>
      </div>
      <div class="bdc-card-footer">
        <a href="{{ url_for('bdc.details', bon_id=b.id) }}" class="bdc-card-action">Voir Détails</a>
      </div>
    </div>
  {% endfor %}
</div>


  <div class="pagination">
    {% if page > 1 %}
    <a href="{{ url_for('bdc.details_recherche', bon_id=bon.id, q=request.args.get('q', ''), min_montant=request.args.get('min_montant'), max_montant=request.args.get('max_montant'), search_in=search_in, page=page-1) }}" class="pagination-link">
      <i class="fas fa-arrow-left"></i> Précédent
    </a>
    {% endif %}
    {% if total_pages > page %}
    <a href="{{ url_for('bdc.details_recherche', bon_id=bon.id, q=request.args.get('q', ''), min_montant=request.args.get('min_montant'), max_montant=request.args.get('max_montant'), search_in=search_in, page=page+1) }}" class="pagination-link">
      Suivant <i class="fas fa-arrow-right"></i>
    </a>
    {% endif %}
  </div>
{% else %}
  <div class="content-card"><p>Aucun résultat.</p></div>
{% endif %}



<style>
  .details-header { margin-bottom: 18px; }
  .details-title { display:flex; justify-content: space-between; align-items:center; }
  .details-title h2 { font-family: var(--font-family-headings); font-size: 24px; font-weight: 700; color: var(--text-dark); margin: 0; }
  .details-actions { display:flex; gap:10px; }
  .action-link {
    display:inline-flex; align-items:center; gap:8px;
    background: linear-gradient(135deg, #2A65F8, #1a52d4);
    color:#fff; padding:8px 14px; border-radius:8px; text-decoration:none; font-weight:600;
    transition: transform .2s ease, box-shadow .2s ease;
  }
  .action-link:hover { transform: translateY(-2px); box-shadow: 0 8px 18px rgba(42,101,248,.25); }

  .search-form .content-card { max-width: 100%; }
  .form-grid { display:grid; grid-template-columns: repeat(auto-fill, minmax(220px, 1fr)); gap: 14px; }
  .form-row { display:flex; flex-direction:column; gap:6px; }
  .form-row select {
    width: 100%;
    padding: 10px 42px 10px 12px;
    border: 1px solid var(--border-color);
    border-radius: 8px;
    background-color: #fff;
    color: var(--text-dark);
    font: inherit;
    line-height: 1.2;
    appearance: none;
    background-image: url("data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='%231a52d4'><path d='M7 10l5 5 5-5z'/></svg>");
    background-repeat: no-repeat;
    background-position: right 12px center;
    background-size: 16px;
    transition: border-color .2s ease, box-shadow .2s ease, background-color .2s ease;
  }
  .form-row select:hover { background-color: #fafbff; }
  .form-row select:focus {
    outline: none;
    border-color: var(--primary-blue);
    box-shadow: 0 0 0 3px rgba(42, 101, 248, 0.2);
    background-color: #fff;
  }
  .bdc-card-details { list-style:none; padding:0; margin:0; font-size: 14px; color:#64748b; }
  .bdc-card-details li { margin-bottom: 6px; }
  .bdc-card-details strong { color:#1e293b; margin-right: 6px; }
  .bdc-card-footer { display:flex; justify-content:flex-end; align-items:center; padding: 12px 18px; background:#f8fafc; border-top:1px solid #e9edf5; border-radius: 0 0 14px 14px; }

  /* Pagination */
  .pagination {
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 12px;
    margin: 24px 0 8px;
    flex-wrap: wrap;
  }
  .pagination-link {
    display: inline-flex;
    align-items: center;
    gap: 8px;
    background: linear-gradient(135deg, #2A65F8, #1a52d4);
    color: #fff;
    padding: 10px 16px;
    border-radius: 10px;
    text-decoration: none;
    font-weight: 600;
    box-shadow: 0 6px 14px rgba(26, 82, 212, 0.22);
    transition: transform .2s ease, box-shadow .2s ease, filter .2s ease;
  }
  .pagination-link:hover { transform: translateY(-2px); box-shadow: 0 10px 22px rgba(26,82,212,.28); filter: brightness(1.02); }
  .pagination-link[aria-disabled="true"], .pagination-link.is-disabled {
    pointer-events: none;
    opacity: .55;
    filter: grayscale(20%);
  }
  .bdc-card-action {
    display: inline-flex;
    align-items: center;
    gap: 8px;
    background: linear-gradient(135deg, #2A65F8, #1a52d4);
    color: #fff;
    padding: 8px 14px;
    border-radius: 10px;
    text-decoration: none;
    font-weight: 600;
    box-shadow: 0 6px 14px rgba(26, 82, 212, 0.25);
    transition: transform .2s ease, box-shadow .2s ease, filter .2s ease;
    position: relative;
    overflow: hidden;
  }
  .bdc-card-action:hover { transform: translateY(-2px); box-shadow: 0 10px 22px rgba(26,82,212,.3); filter: brightness(1.02); }
  .bdc-card-action:active { transform: translateY(0); box-shadow: 0 6px 14px rgba(26,82,212,.25); }
  .bdc-card-action::after {
    content: "\f061"; /* fa-arrow-right */
    font-family: "Font Awesome 6 Free";
    font-weight: 900;
    font-size: 12px;
    margin-left: 6px;
  }

  .bdc-grid { display:grid; grid-template-columns: repeat(auto-fill, minmax(320px, 1fr)); gap: 18px; }
  .bdc-card {
    background: var(--card-bg);
    border: 1px solid var(--border-color);
    border-radius: 14px;
    box-shadow: 0 6px 18px rgba(0,0,0,.05);
    display:flex; flex-direction:column;
    transition: transform .3s ease, box-shadow .3s ease, opacity .4s ease;
    opacity:0; transform: translateY(8px);
  }
  .bdc-card.reveal.show { opacity:1; transform: translateY(0); }
  .bdc-card:hover { transform: translateY(-4px); box-shadow: 0 10px 26px rgba(0,0,0,.08); }
  .bdc-card-header { display:flex; justify-content:space-between; align-items:center; padding: 16px 18px 8px; border-bottom: 1px solid #e9edf5; }
  .bdc-card-title { font-size: 18px; font-weight: 600; color: var(--primary-blue); margin: 0; }
  .bdc-card-body { padding: 14px 18px; flex-grow:1; }
  .bdc-card-details { list-style:none; padding:0; margin:0; font-size: 14px; color:#64748b; }
  .bdc-card-details li { margin-bottom: 6px; }
  .bdc-card-details strong { color:#1e293b; margin-right: 6px; }
  .bdc-card-footer { display:flex; justify-content:flex-end; align-items:center; padding: 12px 18px; background:#f8fafc; border-top:1px solid #e9edf5; border-radius: 0 0 14px 14px; }
</style>

<script>
  // Reveal animation
  const cards = document.querySelectorAll('.bdc-card.reveal');
  const io = new IntersectionObserver((entries) => {
    entries.forEach(e => { if (e.isIntersecting) { e.target.classList.add('show'); io.unobserve(e.target); } });
  }, { threshold: 0.08 });
  cards.forEach(c => io.observe(c));
</script>
{% endblock %}


